<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pakan Unggas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            /* REVISI: Warna background diubah menjadi lebih hangat */
            background-color: #FAF9F6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .wrapper {
            background-color: #FFFFFF;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #004D40; /* Warna hijau tua untuk judul */
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 120px 150px; /* Disesuaikan untuk 3 kolom */
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        .unit-selector {
            display: flex;
        }
        .unit-selector label {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            border: 1px solid #ccc;
            cursor: pointer;
            background-color: #f1f1f1;
        }
        .unit-selector label:first-of-type { border-radius: 4px 0 0 4px; }
        .unit-selector label:last-of-type { border-radius: 0 4px 4px 0; }
        .unit-selector input[type="radio"] { display: none; }
        .unit-selector input[type="radio"]:checked + span {
            background-color: #00796B; /* Warna hijau terpilih */
            color: white;
            border-color: #00796B;
        }
        button#calculate-btn {
            width: 100%;
            padding: 12px;
            background-color: #00796B; /* Tombol utama warna hijau */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button#calculate-btn:hover {
            background-color: #004D40;
        }
        
        /* REVISI: Tombol dukungan yang mencolok */
        .support-section {
            text-align: center;
            margin: 30px 0;
        }
        .support-btn {
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            background-color: #FF9800; /* Warna oranye yang mencolok */
            border: none;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .support-btn:hover {
            transform: scale(1.05);
            background-color: #F57C00;
        }

        #results { display: none; margin-top: 20px; }
        #nutrition-table { width: 100%; margin-top: 15px; border-collapse: collapse; }
        #nutrition-table th, #nutrition-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        #nutrition-table th { background-color: #f2f2f2; }
        #nutrition-table td:nth-child(2) { text-align: right; font-weight: bold; }
        #recommendation { margin-top: 20px; padding: 15px; border-radius: 5px; background-color: #E0F2F1; border-left: 5px solid #00796B;}
        
        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9em;
            color: #6c757d;
        }
        /* REVISI: Kolom Disclaimer */
        .disclaimer {
            margin-top: 20px;
            padding: 10px;
            background-color: #eeeeee;
            border-radius: 5px;
            font-size: 0.8em;
            text-align: justify;
        }
        #loader { text-align: center; padding: 40px; font-size: 1.2em; color: #6c757d; }
        .hidden { display: none; }
        .error { color: red; text-align: center; font-weight: bold; margin: 10px 0;}
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Kalkulator Pakan Unggas</h1>
        </header>

        <div id="loader">Memuat data bahan pakan...</div>

        <form id="calculator-form" class="hidden">
            <div id="ingredient-inputs">
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                    <div class="unit-selector">
                        <label><input type="radio" name="unit-1" value="gram" checked><span>Gram</span></label>
                        <label><input type="radio" name="unit-1" value="percent"><span>%</span></label>
                    </div>
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                    <div class="unit-selector">
                        <label><input type="radio" name="unit-2" value="gram" checked><span>Gram</span></label>
                        <label><input type="radio" name="unit-2" value="percent"><span>%</span></label>
                    </div>
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                    <div class="unit-selector">
                        <label><input type="radio" name="unit-3" value="gram" checked><span>Gram</span></label>
                        <label><input type="radio" name="unit-3" value="percent"><span>%</span></label>
                    </div>
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                    <div class="unit-selector">
                        <label><input type="radio" name="unit-4" value="gram" checked><span>Gram</span></label>
                        <label><input type="radio" name="unit-4" value="percent"><span>%</span></label>
                    </div>
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                    <div class="unit-selector">
                        <label><input type="radio" name="unit-5" value="gram" checked><span>Gram</span></label>
                        <label><input type="radio" name="unit-5" value="percent"><span>%</span></label>
                    </div>
                </div>
            </div>
            <p id="error-message" class="error" style="display:none;"></p>
            <button type="submit" id="calculate-btn">Hitung Kandungan Gizi</button>
        </form>

        <div class="support-section">
            <a href="https://saweria.co/kandanggoen" target="_blank" class="support-btn">â˜• Dukung & Beri Semangat</a>
        </div>


        <div id="results" class="hidden">
            <h2>Hasil Analisis Pakan</h2>
            <p id="total-weight-display" style="text-align:center; font-weight:bold;"></p>
            <table id="nutrition-table">
                <thead><tr><th>Unsur Gizi</th><th>Hasil Campuran</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="recommendation"></div>
        </div>

        <footer class="footer">
            <p>"maju terus peternak Indonesia"</p>
            <p>by. <span><svg height="16" viewBox="0 0 16 16" width="16" style="vertical-align: -2px;"><path d="M4.869 0.002c-1.8 0-2.526 0.222-3.233 0.523-0.743 0.318-1.225 0.75-1.638 1.163C-0.319 2.126 0 2.859 0 4.659v6.682c0 1.8 0.222 2.526 0.523 3.233 0.318 0.743 0.75 1.225 1.163 1.638 0.438 0.417 1.161 0.681 2.126 0.681h6.212c1.8 0 2.526-0.222 3.233-0.523 0.743-0.318 1.225-0.75 1.638-1.163 0.417-0.438 0.681-1.161 0.681-2.126V4.659c0-1.8-0.222-2.526-0.523-3.233-0.318-0.743-0.75-1.225-1.163-1.638C13.291 0.22 12.565 0 10.765 0H4.869zM4.708 1.442h6.584c1.473 0 1.958 0.17 2.316 0.322 0.417 0.177 0.681 0.417 0.941 0.677 0.26 0.26 0.5 0.523 0.677 0.941 0.152 0.358 0.322 0.843 0.322 2.316v6.366c0 1.473-0.17 1.958-0.322 2.316-0.177 0.417-0.417 0.681-0.677 0.941-0.26 0.26-0.523 0.5-0.941 0.677-0.358 0.152-0.843 0.322-2.316 0.322H4.708c-1.473 0-1.958-0.17-2.316-0.322-0.417-0.177-0.681-0.417-0.941-0.677-0.26-0.26-0.5-0.523-0.677-0.941-0.152-0.358-0.322-0.843-0.322-2.316V4.958c0-1.473 0.17-1.958 0.322-2.316 0.177-0.417 0.417-0.681 0.677-0.941 0.26-0.26 0.523-0.5 0.941-0.677 0.358-0.152 0.843-0.322 2.316-0.322zM8 3.889c-2.277 0-4.111 1.834-4.111 4.111s1.834 4.111 4.111 4.111 4.111-1.834 4.111-4.111-1.834-4.111-4.111-4.111zm0 1.442A2.669 2.669 0 115.331 8a2.669 2.669 0 012.669-2.669zm4.269-1.21a0.96 0.96 0 11-1.92 0 0.96 0.96 0 011.92 0z" fill-rule="evenodd"></path></svg></span> kandang.goen</p>
            
            <div class="disclaimer">
                <strong>DISCLAIMER:</strong> Kalkulator ini bersifat sebagai alat bantu estimasi. Kandungan gizi riil pada bahan pakan dapat bervariasi tergantung pada kualitas, proses pengolahan, dan kebijakan produsen pakan. Selalu lakukan pengamatan langsung terhadap kondisi ternak Anda.
            </div>
        </footer>
    </div>
    
    <script>
        let feedData = {};

        // Fungsi parseValue untuk menangani format data (tidak berubah)
        function parseValue(text) {
            if (typeof text !== 'string') return text || 0;
            const cleanText = text.trim().toLowerCase();
            if (!cleanText || cleanText === 'n/a' || cleanText === 'ada') return 0;
            if (cleanText.startsWith('min')) return parseFloat(cleanText.replace('min', '').trim()) || 0;
            if (cleanText.startsWith('max')) return parseFloat(cleanText.replace('max', '').trim()) || 0;
            if (cleanText.includes('-')) {
                const parts = cleanText.split('-').map(s => parseFloat(s.trim()));
                if (parts.length > 1 && !isNaN(parts[0]) && !isNaN(parts[1])) { return (parts[0] + parts[1]) / 2; }
                return parseFloat(parts[0]) || 0;
            }
            return parseFloat(cleanText) || 0;
        }

        // Fungsi fetch data dari unsur_pakan.html (tidak berubah)
        async function loadAndParseData() {
            try {
                const response = await fetch('unsur_pakan.html');
                if (!response.ok) throw new Error(`Gagal memuat file data (Status: ${response.status})`);
                const htmlText = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const data = {};
                const rows = doc.querySelectorAll('table tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length > 1) {
                        const name = cells[0].textContent.trim();
                        if (name) {
                           data[name] = {
                                protein: parseValue(cells[1].textContent),
                                energi: parseValue(cells[2].textContent),
                                lemak: parseValue(cells[3].textContent),
                                serat: parseValue(cells[4].textContent),
                                kalsium: parseValue(cells[5].textContent),
                                fosfor: parseValue(cells[6] ? cells[6].textContent : '0')
                            };
                        }
                    }
                });
                return data;
            } catch (error) {
                console.error("Error saat memuat data:", error);
                document.getElementById('loader').textContent = `Error: Gagal memuat data dari unsur_pakan.html. Pastikan file ada di server & nama file sudah benar.`;
                return null;
            }
        }
        
        // Fungsi utama yang berjalan saat halaman dimuat
        window.onload = async () => {
            const data = await loadAndParseData();
            if (data && Object.keys(data).length > 0) {
                feedData = data;
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('calculator-form').classList.remove('hidden');

                const selects = document.querySelectorAll('.ingredient-select');
                const ingredients = Object.keys(feedData).sort();
                let optionsHTML = '<option value="">-- Pilih Bahan Pakan --</option>';
                ingredients.forEach(name => {
                    optionsHTML += `<option value="${name}">${name}</option>`;
                });
                selects.forEach(select => {
                    select.innerHTML = optionsHTML;
                });
            }
        };

        // Event listener untuk form submit
        document.getElementById('calculator-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none';

            let finalNutrients = { protein: 0, energi: 0, lemak: 0, serat: 0, kalsium: 0, fosfor: 0 };
            let totalWeight = 0;
            let totalPercent = 0;
            let isPercentMode = false;
            let isGramMode = false;

            const rows = document.querySelectorAll('.input-row');
            const inputs = [];

            // Membaca semua input dan menentukan mode (Gram atau Persen)
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const ingredientName = row.querySelector('.ingredient-select').value;
                const amount = parseFloat(row.querySelector('.ingredient-amount').value);
                const unit = row.querySelector('input[type="radio"]:checked').value;

                if (ingredientName && amount > 0) {
                    inputs.push({ name: ingredientName, amount: amount, unit: unit });
                    if(unit === 'gram') isGramMode = true;
                    if(unit === 'percent') isPercentMode = true;
                }
            }

            // Validasi agar tidak mencampur mode Gram dan Persen
            if (isGramMode && isPercentMode) {
                errorMessage.textContent = 'Mode perhitungan tidak boleh dicampur. Gunakan Gram semua atau Persen semua.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Logika Perhitungan
            if (isGramMode) {
                inputs.forEach(input => {
                    const nutrientData = feedData[input.name];
                    totalWeight += input.amount;
                    for (const key in finalNutrients) {
                        finalNutrients[key] += input.amount * (nutrientData[key] || 0);
                    }
                });
                if (totalWeight > 0) {
                    for (const key in finalNutrients) {
                        finalNutrients[key] /= totalWeight;
                    }
                }
            } else if (isPercentMode) {
                inputs.forEach(input => {
                    const nutrientData = feedData[input.name];
                    totalPercent += input.amount;
                    for (const key in finalNutrients) {
                        finalNutrients[key] += input.amount / 100 * (nutrientData[key] || 0);
                    }
                });
                if (Math.abs(totalPercent - 100) > 0.01 && totalPercent > 0) {
                    errorMessage.textContent = `Total persentase harus 100%, saat ini totalnya ${totalPercent.toFixed(1)}%.`;
                    errorMessage.style.display = 'block';
                    return;
                }
            }

            if (inputs.length > 0) {
                displayResults(finalNutrients, totalWeight, isGramMode ? 'gram' : 'percent');
            } else {
                 errorMessage.textContent = 'Silakan isi minimal satu bahan pakan dan jumlahnya.';
                 errorMessage.style.display = 'block';
            }
        });

        // Fungsi untuk menampilkan hasil
        function displayResults(nutrients, weight, unit) {
            const resultsDiv = document.getElementById('results');
            const tableBody = document.querySelector("#nutrition-table tbody");
            const recommendationEl = document.getElementById('recommendation');
            const totalWeightEl = document.getElementById('total-weight-display');

            tableBody.innerHTML = `
                <tr><td>Protein Kasar</td><td>${nutrients.protein.toFixed(2)} %</td></tr>
                <tr><td>Energi Metabolisme</td><td>${nutrients.energi.toFixed(0)} kkal/kg</td></tr>
                <tr><td>Lemak Kasar</td><td>${nutrients.lemak.toFixed(2)} %</td></tr>
                <tr><td>Serat Kasar</td><td>${nutrients.serat.toFixed(2)} %</td></tr>
                <tr><td>Kalsium</td><td>${nutrients.kalsium.toFixed(3)} %</td></tr>
                <tr><td>Fosfor</td><td>${nutrients.fosfor.toFixed(3)} %</td></tr>
            `;
            
            totalWeightEl.textContent = (unit === 'gram' && weight > 0) ? `Total Bobot Campuran: ${weight.toFixed(2)} Gram` : '';
            
            let recHTML = '';
            const protein = nutrients.protein;
            if (protein > 0 && protein < 17) {
                 recHTML = `<strong>Rekomendasi:</strong> Kurang cocok (Protein di bawah 17%). Disarankan menambah bahan sumber protein tinggi seperti Bungkil Kedelai atau Tepung Ikan.`;
            } else if (protein >= 17 && protein < 18) {
                 recHTML = `<strong>Rekomendasi:</strong> Cukup untuk fase Finisher atau Layer (Ayam Petelur Produksi).`;
            } else if (protein >= 18 && protein < 21) {
                recHTML = `<strong>Rekomendasi:</strong> Sangat baik untuk fase Pertumbuhan (Grower).`;
            } else if (protein >= 21) {
                recHTML = `<strong>Rekomendasi:</strong> Sangat baik untuk fase Awal (Starter).`;
            } else {
                recHTML = 'Tidak ada data untuk ditampilkan.';
            }
            recommendationEl.innerHTML = recHTML;

            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

</body>
</html>
