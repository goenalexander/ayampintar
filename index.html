<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pakan Unggas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #FAF9F6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .wrapper {
            background-color: #FFFFFF;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #004D40;
        }
        /* REVISI: Mengembalikan radio button tunggal di atas */
        .unit-selection {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .unit-selection label {
            margin: 0 15px;
            cursor: pointer;
            padding: 8px;
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 120px;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        button#calculate-btn {
            width: 100%;
            padding: 12px;
            background-color: #00796B;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button#calculate-btn:hover {
            background-color: #004D40;
        }
        
        /* REVISI: Desain ulang bagian dukungan */
        .support-section {
            text-align: center;
            margin: 40px 0;
            padding: 20px;
            background-color: #f7f7f7;
            border-radius: 8px;
        }
        .support-section h3 {
            margin-top: 0;
            font-size: 1.2em;
            color: #333;
        }
        .support-section p {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 20px;
        }
        .support-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #FFC107, #FF9800);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.4);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .support-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.5);
        }

        #results { 
            display: none; 
            margin-top: 20px;
            /* REVISI: Latar belakang lembut pada tabel hasil */
            background-color: #E8F5E9; /* Warna hijau sangat muda */
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #C8E6C9;
        }
        #nutrition-table { width: 100%; border-collapse: collapse; background-color: #fff; }
        #nutrition-table th, #nutrition-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        #nutrition-table th { background-color: #f2f2f2; }
        #nutrition-table td:nth-child(2) { text-align: right; font-weight: bold; }
        /* REVISI: Style khusus untuk baris protein */
        .protein-row td {
            font-weight: bold !important;
            font-size: 1.1em;
            color: #1B5E20; /* Warna hijau lebih gelap */
        }

        #recommendation { margin-top: 20px; padding: 15px; border-radius: 5px; background-color: #FFFFFF; border-left: 5px solid #00796B;}
        
        .footer { margin-top: 40px; text-align: center; font-size: 0.9em; color: #6c757d; }
        .disclaimer {
            margin-top: 20px;
            padding: 10px;
            background-color: #eeeeee;
            border-radius: 5px;
            font-size: 0.8em;
            text-align: justify;
        }
        #loader { text-align: center; padding: 40px; font-size: 1.2em; color: #6c757d; }
        .hidden { display: none; }
        .error { color: red; text-align: center; font-weight: bold; margin: 10px 0;}
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Kalkulator Pakan Unggas</h1>
        </header>

        <div id="loader">Memuat data bahan pakan...</div>

        <form id="calculator-form" class="hidden">
            <div class="unit-selection">
                <label><input type="radio" name="unit" value="gram" checked> Gram</label>
                <label><input type="radio" name="unit" value="percent"> Persen (%)</label>
            </div>
            <hr style="border: none; border-top: 1px solid #eee; margin: 25px 0;">

            <div id="ingredient-inputs">
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                </div>
                <div class="input-row">
                    <select class="ingredient-select"></select>
                    <input type="number" class="ingredient-amount" placeholder="Jumlah" min="0" step="any">
                </div>
            </div>
            <p id="error-message" class="error" style="display:none;"></p>
            <button type="submit" id="calculate-btn">Hitung Kandungan Gizi</button>
        </form>

        <div class="support-section">
            <h3>Suka dengan Alat Ini? Bantu Kami Berkembang!</h3>
            <p>Dukungan Anda membantu kami menambahkan fitur baru dan menjaga web ini tetap gratis untuk semua peternak.</p>
            <a href="https://saweria.co/jalangoen" target="_blank" class="support-btn">Beri Secangkir Kopi â˜•</a>
        </div>


        <div id="results" class="hidden">
            <h2>Hasil Analisis Pakan</h2>
            <p id="total-weight-display" style="text-align:center; font-weight:bold;"></p>
            <table id="nutrition-table">
                <thead><tr><th>Unsur Gizi</th><th>Hasil Campuran</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="recommendation"></div>
        </div>

        <footer class="footer">
            <p>"maju terus peternak Indonesia"</p>
            <p>by. <a href="https://www.instagram.com/jalan.goen" target="_blank" style="text-decoration:none; color:inherit;"><span><svg height="16" viewBox="0 0 16 16" width="16" style="vertical-align: -2px;"><path d="M4.869 0.002c-1.8 0-2.526 0.222-3.233 0.523-0.743 0.318-1.225 0.75-1.638 1.163C-0.319 2.126 0 2.859 0 4.659v6.682c0 1.8 0.222 2.526 0.523 3.233 0.318 0.743 0.75 1.225 1.638 1.638 0.438 0.417 1.161 0.681 2.126 0.681h6.212c1.8 0 2.526-0.222 3.233-0.523 0.743-0.318 1.225-0.75 1.638-1.163 0.417-0.438 0.681-1.161 0.681-2.126V4.659c0-1.8-0.222-2.526-0.523-3.233-0.318-0.743-0.75-1.225-1.163-1.638C13.291 0.22 12.565 0 10.765 0H4.869zM4.708 1.442h6.584c1.473 0 1.958 0.17 2.316 0.322 0.417 0.177 0.681 0.417 0.941 0.677 0.26 0.26 0.5 0.523 0.677 0.941 0.152 0.358 0.322 0.843 0.322 2.316v6.366c0 1.473-0.17 1.958-0.322 2.316-0.177 0.417-0.417 0.681-0.677 0.941-0.26 0.26-0.523 0.5-0.941 0.677-0.358 0.152-0.843 0.322-2.316 0.322H4.708c-1.473 0-1.958-0.17-2.316-0.322-0.417-0.177-0.681-0.417-0.941-0.677-0.26-0.26-0.5-0.523-0.677-0.941-0.152-0.358-0.322-0.843-0.322-2.316V4.958c0-1.473 0.17-1.958 0.322-2.316 0.177-0.417 0.417-0.681 0.677-0.941 0.26-0.26 0.523-0.5 0.941-0.677 0.358-0.152 0.843-0.322 2.316-0.322zM8 3.889c-2.277 0-4.111 1.834-4.111 4.111s1.834 4.111 4.111 4.111 4.111-1.834 4.111-4.111-1.834-4.111-4.111-4.111zm0 1.442A2.669 2.669 0 115.331 8a2.669 2.669 0 012.669-2.669zm4.269-1.21a0.96 0.96 0 11-1.92 0 0.96 0.96 0 011.92 0z" fill-rule="evenodd"></path></svg></span> kandang.goen</a></p>
            
            <div class="disclaimer">
                <strong>DISCLAIMER:</strong> Kalkulator ini bersifat sebagai alat bantu estimasi. Kandungan gizi riil pada bahan pakan dapat bervariasi tergantung pada kualitas, proses pengolahan, dan kebijakan produsen pakan. Selalu lakukan pengamatan langsung terhadap kondisi ternak Anda.
            </div>
        </footer>
    </div>
    
    <script>
        let feedData = {};

        function parseValue(text) {
            if (typeof text !== 'string') return text || 0;
            const cleanText = text.trim().toLowerCase();
            if (!cleanText || cleanText === 'n/a' || cleanText === 'ada') return 0;
            if (cleanText.startsWith('min')) return parseFloat(cleanText.replace('min', '').trim()) || 0;
            if (cleanText.startsWith('max')) return parseFloat(cleanText.replace('max', '').trim()) || 0;
            if (cleanText.includes('-')) {
                const parts = cleanText.split('-').map(s => parseFloat(s.trim()));
                if (parts.length > 1 && !isNaN(parts[0]) && !isNaN(parts[1])) { return (parts[0] + parts[1]) / 2; }
                return parseFloat(parts[0]) || 0;
            }
            return parseFloat(cleanText) || 0;
        }

        async function loadAndParseData() {
            try {
                const response = await fetch('unsur_pakan.html');
                if (!response.ok) throw new Error(`Gagal memuat file data (Status: ${response.status})`);
                const htmlText = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const data = {};
                const rows = doc.querySelectorAll('table tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length > 1) {
                        const name = cells[0].textContent.trim();
                        if (name) {
                           data[name] = {
                                protein: parseValue(cells[1].textContent),
                                energi: parseValue(cells[2].textContent),
                                lemak: parseValue(cells[3].textContent),
                                serat: parseValue(cells[4].textContent),
                                kalsium: parseValue(cells[5].textContent),
                                fosfor: parseValue(cells[6] ? cells[6].textContent : '0')
                            };
                        }
                    }
                });
                return data;
            } catch (error) {
                console.error("Error saat memuat data:", error);
                document.getElementById('loader').textContent = `Error: Gagal memuat data dari unsur_pakan.html. Pastikan file ada di server & nama file sudah benar.`;
                return null;
            }
        }
        
        window.onload = async () => {
            const data = await loadAndParseData();
            if (data && Object.keys(data).length > 0) {
                feedData = data;
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('calculator-form').classList.remove('hidden');

                const selects = document.querySelectorAll('.ingredient-select');
                const ingredients = Object.keys(feedData).sort();
                let optionsHTML = '<option value="">-- Pilih Bahan Pakan --</option>';
                ingredients.forEach(name => {
                    optionsHTML += `<option value="${name}">${name}</option>`;
                });
                selects.forEach(select => {
                    select.innerHTML = optionsHTML;
                });
            }
        };

        document.getElementById('calculator-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none';

            // REVISI: Mengambil nilai satuan dari radio button tunggal
            const unit = document.querySelector('input[name="unit"]:checked').value;
            let finalNutrients = { protein: 0, energi: 0, lemak: 0, serat: 0, kalsium: 0, fosfor: 0 };
            
            if (unit === 'gram') {
                let totalWeight = 0;
                const rows = document.querySelectorAll('.input-row');
                rows.forEach(row => {
                    const ingredientName = row.querySelector('.ingredient-select').value;
                    const amount = parseFloat(row.querySelector('.ingredient-amount').value);
                    if (ingredientName && amount > 0) {
                        const nutrientData = feedData[ingredientName];
                        totalWeight += amount;
                        for (const key in finalNutrients) {
                            finalNutrients[key] += amount * (nutrientData[key] || 0);
                        }
                    }
                });
                if (totalWeight > 0) {
                    for (const key in finalNutrients) {
                        finalNutrients[key] /= totalWeight;
                    }
                    displayResults(finalNutrients, totalWeight, 'gram');
                } else {
                    errorMessage.textContent = 'Silakan isi minimal satu bahan pakan dan jumlahnya.';
                    errorMessage.style.display = 'block';
                }
            } else { // unit is 'percent'
                let totalPercent = 0;
                const rows = document.querySelectorAll('.input-row');
                rows.forEach(row => {
                    const ingredientName = row.querySelector('.ingredient-select').value;
                    const amount = parseFloat(row.querySelector('.ingredient-amount').value);
                    if (ingredientName && amount > 0) {
                        const nutrientData = feedData[ingredientName];
                        totalPercent += amount;
                        for (const key in finalNutrients) {
                            finalNutrients[key] += amount / 100 * (nutrientData[key] || 0);
                        }
                    }
                });
                if (Math.abs(totalPercent - 100) > 0.01 && totalPercent > 0) {
                    errorMessage.textContent = `Total persentase harus 100%, saat ini totalnya ${totalPercent.toFixed(1)}%.`;
                    errorMessage.style.display = 'block';
                    return;
                }
                 if (totalPercent > 0) {
                    displayResults(finalNutrients, 100, 'percent');
                 } else {
                    errorMessage.textContent = 'Silakan isi minimal satu bahan pakan dan jumlahnya.';
                    errorMessage.style.display = 'block';
                 }
            }
        });

        function displayResults(nutrients, weight, unit) {
            const resultsDiv = document.getElementById('results');
            const tableBody = document.querySelector("#nutrition-table tbody");
            const recommendationEl = document.getElementById('recommendation');
            const totalWeightEl = document.getElementById('total-weight-display');
            const nutrientLabels = {
                protein: 'Protein Kasar',
                energi: 'Energi Metabolisme',
                lemak: 'Lemak Kasar',
                serat: 'Serat Kasar',
                kalsium: 'Kalsium',
                fosfor: 'Fosfor'
            };
            
            let tableHTML = '';
            for (const key in nutrients) {
                const isProtein = key === 'protein';
                const value = (key === 'energi') ? nutrients[key].toFixed(0) + ' kkal/kg' : nutrients[key].toFixed(isProtein ? 2 : 3) + ' %';
                // REVISI: Menambahkan class 'protein-row' jika unsur gizinya protein
                tableHTML += `<tr class="${isProtein ? 'protein-row' : ''}">
                                <td>${nutrientLabels[key]}</td>
                                <td>${value}</td>
                              </tr>`;
            }
            tableBody.innerHTML = tableHTML;
            
            totalWeightEl.textContent = (unit === 'gram' && weight > 0) ? `Total Bobot Campuran: ${weight.toFixed(2)} Gram` : '';
            
            let recHTML = '';
            const protein = nutrients.protein;
            if (protein > 0 && protein < 17) {
                 recHTML = `<strong>Rekomendasi:</strong> Kurang cocok (Protein di bawah 17%). Disarankan menambah bahan sumber protein tinggi seperti Bungkil Kedelai atau Tepung Ikan.`;
            } else if (protein >= 17 && protein < 18) {
                 recHTML = `<strong>Rekomendasi:</strong> Cukup untuk fase Finisher atau Layer (Ayam Petelur Produksi).`;
            } else if (protein >= 18 && protein < 21) {
                recHTML = `<strong>Rekomendasi:</strong> Sangat baik untuk fase Pertumbuhan (Grower).`;
            } else if (protein >= 21) {
                recHTML = `<strong>Rekomendasi:</strong> Sangat baik untuk fase Awal (Starter).`;
            } else {
                recHTML = 'Tidak ada data untuk ditampilkan.';
            }
            recommendationEl.innerHTML = recHTML;

            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

</body>
</html>
